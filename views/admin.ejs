<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Pixel Stop</title>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="container nav-container">
            <div class="logo">
                <img src="/images/logo.svg" alt="Pixel Stop Logo" onerror="this.src='/images/placeholder.png'">
                <span>Pixel Stop</span>
            </div>
            <ul class="nav-links">
                <li><a href="/">Home</a></li>
                <li><a href="/about">About</a></li>
                <li><a href="/products">Products</a></li>
                <li><a href="/contact">Contact</a></li>
                <% if (typeof currentUser !== 'undefined' && currentUser) { %>
                    <li><a href="/users/dashboard">Dashboard</a></li>
                    <li><a href="/users/logout">Logout</a></li>
                <% } else { %>
                    <li><a href="/users/login">Login</a></li>
                    <li><a href="/users/register">Register</a></li>
                <% } %>
            </ul>
        </div>
    </nav>

    <!-- Flash Messages -->
    <% if (typeof message !== 'undefined' && message && message.length > 0) { %>
        <div class="container">
            <div class="alert alert-success">
                <%= message %>
            </div>
        </div>
    <% } %>
    
    <% if (typeof error !== 'undefined' && error && error.length > 0) { %>
        <div class="container">
            <div class="alert alert-danger">
                <%= error %>
            </div>
        </div>
    <% } %>

    <!-- Main Content -->
    <main>
        <section class="hero" style="background: linear-gradient(to bottom, var(--pastel-yellow), var(--pastel-green));">
            <h1>Admin Dashboard</h1>
            <p>Welcome, <%= currentUser.firstName %> (<%= currentUser.role %>)</p>
        </section>

        <section>
            <div class="container dashboard-container">
                <!-- Sidebar Navigation -->
                <div class="dashboard-sidebar">
                    <div class="pixel-box">
                        <h3>Admin Menu</h3>
                        <ul class="dashboard-menu">
                            <li><a href="/users/admin" class="active">User Management</a></li>
                            <li><a href="/users/dashboard">My Dashboard</a></li>
                            <li><a href="#">Product Management</a></li>
                            <li><a href="#">Order Management</a></li>
                            <li><a href="/contact/messages">Contact Messages</a></li>
                            <li><a href="#">Site Settings</a></li>
                            <li><a href="/users/logout">Logout</a></li>
                        </ul>
                    </div>
                </div>

                <!-- Main Content -->
                <div class="dashboard-content">
                    <div class="pixel-box" style="overflow: hidden; padding: 1.5rem 1rem;">
                        <h2>User Management</h2>
                        <div style="overflow-x: auto; margin-top: 1.5rem; max-width: 100%;">
                            <table class="data-table data-table-compact" style="min-width: 850px;">
                                <thead>
                                    <tr>
                                        <th class="column-id">User ID</th>
                                        <th class="column-name">Name</th>
                                        <th class="column-email">Email</th>
                                        <th class="column-role">Role</th>
                                        <th class="column-status">Status</th>
                                        <th class="column-date">Created</th>
                                        <th class="column-actions">Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <% users.forEach(user => { %>
                                        <tr>
                                            <td class="single-line">
                                                <div class="user-id-wrapper">
                                                    <span class="short-id"><%= user.userId.length > 10 ? user.userId.substring(0, 8) + '...' : user.userId %></span>
                                                    <span class="full-id"><%= user.userId %> <button class="copy-id" data-id="<%= user.userId %>" title="Copy ID" style="background: none; border: none; color: white; cursor: pointer; font-size: 0.7rem;">ðŸ“‹</button></span>
                                                </div>
                                            </td>
                                            <td>
                                                <%= user.firstName %> <%= user.lastName %>
                                            </td>
                                            <td><%= user.email %></td>
                                            <td><%= user.role %></td>
                                            <td><%= user.accountStatus %></td>
                                            <td><%= user.createdAt.toLocaleDateString() %></td>
                                            <td>
                                                <div style="display: flex; gap: 0.3rem; flex-wrap: wrap;">
                                                    <a href="/users/edit/<%= user.userId %>" class="pixel-btn btn-edit" style="font-size: 0.7rem; padding: 0.25rem 0.5rem; margin: 0; line-height: 1;">Edit</a>
                                                    <% if (user.userId !== currentUser.userId) { %>
                                                        <a href="/users/delete/<%= user.userId %>" class="pixel-btn btn-delete" style="font-size: 0.7rem; padding: 0.25rem 0.5rem; margin: 0; line-height: 1;" onclick="return confirm('Are you sure you want to delete this user?')">Delete</a>
                                                    <% } %>
                                                </div>
                                            </td>
                                        </tr>
                                    <% }); %>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
     <%- include('/partials/footer.ejs') %>

    <!-- JavaScript for ID copying -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Add click event to copy buttons
            document.querySelectorAll('.copy-id').forEach(button => {
                button.addEventListener('click', function(e) {
                    e.stopPropagation(); // Prevent tooltip from closing
                    const id = this.getAttribute('data-id');
                    
                    // Copy to clipboard
                    navigator.clipboard.writeText(id).then(() => {
                        // Show feedback
                        const originalText = this.textContent;
                        this.textContent = 'âœ“';
                        this.style.color = '#54c754';
                        
                        // Reset after 2 seconds
                        setTimeout(() => {
                            this.textContent = originalText;
                            this.style.color = 'white';
                        }, 2000);
                    });
                });
            });
        });
    </script>
</body>
</html>